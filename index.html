<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 æ–°å¹´ä¿¡ç¬º</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --paper-color: #fff9e6;
            --env-color: #c0392b;
            --env-flap: #e74c3c;
            --bg-1: #fdaffa; --bg-2: #b4df9b; --bg-3: #b6cdad;
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; display: flex; justify-content: center; align-items: center;
            touch-action: none; /* é˜²æ­¢æ‰‹æœºç«¯é»˜è®¤ç¼©æ”¾ */
        }

        /* æ¸å˜èƒŒæ™¯ */
        #bg-wrapper {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120%;
            z-index: -2; transition: transform 0.1s ease-out;
        }
        .wave-bg {
            width: 400%; height: 100%;
            background: linear-gradient(90deg, var(--bg-1), var(--bg-2), var(--bg-3), var(--bg-1));
            background-size: 25% 100%; animation: waveFlow 15s linear infinite;
        }
        @keyframes waveFlow { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* æ˜Ÿç©ºæ–‡å­— */
        #star-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .star-text { position: absolute; color: rgba(255,255,255,0.8); font-weight: bold; opacity: 0; animation: twinkle var(--duration) ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.1; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.1); } }

        /* ä¿¡å° UI é€‚é…æ‰‹æœºå®½åº¦ */
        .envelope-container {
            position: relative; width: 85vw; height: 55vw; max-width: 320px; max-height: 200px;
            background: var(--env-color); cursor: pointer; z-index: 100;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 15px 45px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
        }
        .envelope-container::before {
            content: ""; position: absolute; top: 0; left: 0;
            border-left: 42.5vw solid transparent; border-right: 42.5vw solid transparent;
            border-top: 30vw solid var(--env-flap); transform-origin: top; transition: 0.5s; z-index: 4;
        }
        @media (min-width: 320px) {
            .envelope-container::before { border-left-width: 160px; border-right-width: 160px; border-top-width: 110px; }
        }

        .seal {
            position: absolute; bottom: 15%; width: 60px; height: 60px; background: #a52a2a;
            border-radius: 50%; z-index: 10; display: flex; justify-content: center; align-items: center;
            color: #ffd700; font-weight: bold; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            transition: 0.3s;
        }
        /* é•¿æŒ‰æ—¶çš„æ³¢çº¹æ•ˆæœ */
        .seal.pressing { transform: scale(0.9); background: #802020; box-shadow: 0 0 20px #ffd700; }

        /* å±•å¼€åé€‚é…å…¨å± */
        .envelope-container.is-open {
            width: 90vw; height: 80vh; max-width: 90vw; max-height: 85vh;
            background: var(--paper-color); cursor: default; flex-direction: column; 
            padding: 30px 20px; box-sizing: border-box; border-radius: 12px;
        }
        .envelope-container.is-open::before, .envelope-container.is-open .seal { opacity: 0; pointer-events: none; }

        #typewriter { font-size: 1rem; color: #333; line-height: 1.8; text-align: center; white-space: pre-wrap; margin-top: 15px; overflow-y: auto; }
        .gift-box { display: none; flex-direction: column; align-items: center; margin-top: 20px; cursor: pointer; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        #close-btn { position: absolute; top: 10px; right: 10px; font-size: 24px; border: none; background: none; color: #999; display: none; }
        .envelope-container.is-open #close-btn { display: block; }

        #music-control { position: fixed; top: 15px; right: 15px; width: 36px; height: 36px; z-index: 1000; border-radius: 50%; background: rgba(255,255,255,0.3); display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); border: 1px solid #fff; }
        #music-control.playing { animation: rotateDisk 5s linear infinite; }
        @keyframes rotateDisk { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="bg-wrapper">
        <div class="wave-bg"></div>
    </div>
    <div id="star-container"></div>
    <audio id="bgAudio" src="bg-music.mp3" loop></audio>
    <div id="music-control">â™ª</div>

    <div class="envelope-container" id="mainEnvelope">
        <span id="env-label" style="color:#FFD700; z-index:5; font-size: 1rem; margin-bottom: 40px;">é•¿æŒ‰ç«æ¼†å°ç« å¼€å¯</span>
        <div class="seal" id="sealBtn">ç¦</div>
        <button id="close-btn">âœ•</button>
        <div id="letter-content" style="display:none; width:100%;">
            <h2 style="color:var(--env-color); text-align:center; margin:0; font-size: 1.4rem;">è‡´ï¼šä¸œã€æ¬£</h2>
            <div id="typewriter"></div>
            <div class="gift-box" id="giftBtn">
                <span style="font-size:40px;">ğŸ</span>
                <span style="font-size:12px; color:var(--env-color); font-weight:bold;">æ–°å¹´å¥½ç¤¼ (ç‚¹å‡»)</span>
            </div>
        </div>
    </div>

    <script>
        const config = { text: "äº²çˆ±çš„æœ‹å‹ï¼š\n\nè§å­—å¦‚æ™¤ã€‚\næ–°å¹´çš„é’Ÿå£°å³å°†æ•²å“ï¼Œæ„¿è¿™å°ä¿¡å¸¦å»æœ€æ¸©æ¶¦çš„ç¥ç¦ã€‚\nç”Ÿæ´»å¦‚è¯—ï¼Œå²æœˆå¦‚ç”»ã€‚\næ„¿ 2026 å¹´çš„ä½ ï¼Œä¸‡äº‹èƒœæ„ï¼Œä¸è´ŸéŸ¶åã€‚" };

        // 1. æ‰‹æœºç«¯èƒŒæ™¯ä½ç§» (é™€èºä»ªè½»å¾®äº¤äº’)
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            // iOS éœ€è¦æˆæƒ
            document.body.addEventListener('click', () => {
                DeviceOrientationEvent.requestPermission();
            }, { once: true });
        }
        window.addEventListener('deviceorientation', (e) => {
            const tiltX = Math.floor(e.gamma) / 3; // å·¦å³å€¾æ–œ
            const tiltY = Math.floor(e.beta) / 3;  // å‰åå€¾æ–œ
            document.getElementById('bg-wrapper').style.transform = `translate(${tiltX}px, ${tiltY}px)`;
        });

        // 2. æ˜Ÿç©ºç”Ÿæˆ
        const starContainer = document.getElementById('star-container');
        for (let i = 0; i < 40; i++) {
            const s = document.createElement('div');
            s.className = 'star-text';
            s.innerText = ["âœ¨", "â¤ï¸", "2026"][Math.floor(Math.random() * 3)];
            s.style.left = Math.random() * 100 + "%"; s.style.top = Math.random() * 100 + "%";
            s.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
            s.style.setProperty('--delay', (Math.random() * 5) + 's');
            starContainer.appendChild(s);
        }

        // 3. é•¿æŒ‰å¼€å¯é€»è¾‘
        const sealBtn = document.getElementById('sealBtn');
        const env = document.getElementById('mainEnvelope');
        let pressTimer;

        function startPress() {
            sealBtn.classList.add('pressing');
            pressTimer = setTimeout(openEnvelope, 1000); // æŒ‰ä½ 1 ç§’å¼€å¯
        }
        function endPress() {
            sealBtn.classList.remove('pressing');
            clearTimeout(pressTimer);
        }

        sealBtn.addEventListener('touchstart', startPress);
        sealBtn.addEventListener('touchend', endPress);
        sealBtn.addEventListener('mousedown', startPress); // é€‚é…ç”µè„‘è°ƒè¯•
        sealBtn.addEventListener('mouseup', endPress);

        function openEnvelope() {
            if (env.classList.contains('is-open')) return;
            env.classList.add('is-open');
            document.getElementById('env-label').style.display = 'none';
            document.getElementById('letter-content').style.display = 'block';
            document.getElementById('bgAudio').play().catch(() => {});
            document.getElementById('music-control').classList.add('playing');
            
            setTimeout(() => {
                typeWriter(config.text, 0, () => {
                    document.getElementById('giftBtn').style.display = 'flex';
                });
            }, 800);
        }

        function typeWriter(text, i, fnCallback) {
            if (i < text.length) {
                document.getElementById("typewriter").innerHTML = text.substring(0, i+1) + '<span style="color:var(--env-color)">|</span>';
                setTimeout(() => typeWriter(text, i + 1, fnCallback), 80);
            } else if (typeof fnCallback == 'function') fnCallback();
        }

        // 4. æ’’èŠ±
        document.getElementById('giftBtn').onclick = (e) => {
            e.stopPropagation();
            confetti({ particleCount: 100, spread: 60, origin: { y: 0.7 } });
            // æ‰‹æœºç«¯éœ‡åŠ¨åé¦ˆ (éƒ¨åˆ†å®‰å“æ”¯æŒ)
            if (navigator.vibrate) navigator.vibrate(50);
        };

        document.getElementById('close-btn').onclick = (e) => {
            e.stopPropagation();
            env.classList.remove('is-open');
            setTimeout(() => {
                document.getElementById('env-label').style.display = 'block';
                document.getElementById('letter-content').style.display = 'none';
                document.getElementById('typewriter').innerHTML = "";
            }, 800);
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 新年信笺</title>
    <style>
        :root {
            --paper-color: #fff9e6;
            --env-color: #c0392b;
            --env-flap: #e74c3c;
            /* 固定为你指定的色号 */
            --bg-1: #fdaffa; 
            --bg-2: #b4df9b; 
            --bg-3: #b6cdad;
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; display: flex; justify-content: center; align-items: center; 
        }

        /* --- 渐变波浪背景 --- */
        .wave-bg {
            position: fixed; top: 0; left: 0; 
            width: 400%; height: 100%;
            background: linear-gradient(90deg, var(--bg-1), var(--bg-2), var(--bg-3), var(--bg-1));
            background-size: 25% 100%;
            z-index: -2;
            animation: waveFlow 15s linear infinite;
        }
        @keyframes waveFlow { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- 一闪一闪星空层 --- */
        #star-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }
        .star-text {
            position: absolute; color: rgba(255,255,255,0.8); font-weight: bold;
            opacity: 0; animation: twinkle var(--duration) ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.1; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* --- 信封 UI --- */
        .envelope-container {
            position: relative; width: 280px; height: 180px;
            background: var(--env-color); cursor: pointer; z-index: 100;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 15px 45px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
        }
        .envelope-container::before {
            content: ""; position: absolute; top: 0; left: 0;
            border-left: 140px solid transparent; border-right: 140px solid transparent;
            border-top: 100px solid var(--env-flap);
            transform-origin: top; transition: 0.5s; z-index: 4;
        }
        /* 手机端适配宽度 */
        .envelope-container.is-open {
            width: 85vw; height: 70vh; background: var(--paper-color);
            cursor: default; flex-direction: column; padding: 40px 20px; box-sizing: border-box; border-radius: 8px;
        }
        .envelope-container.is-open::before { transform: rotateX(180deg); opacity: 0; }

        #typewriter { font-size: 1.15rem; color: #333; line-height: 2; text-align: center; white-space: pre-wrap; margin-top: 20px; }
        
        #close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; background: none; border: none; color: #999; display: none; }
        .envelope-container.is-open #close-btn { display: block; }

        #music-control {
            position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; z-index: 1000;
            cursor: pointer; border-radius: 50%; background: rgba(255,255,255,0.3);
            display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        #music-control.playing { animation: rotateDisk 5s linear infinite; }
        @keyframes rotateDisk { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="wave-bg"></div>
    <div id="star-container"></div>

    <audio id="bgAudio" src="bg-music.mp3" loop></audio>
    <div id="music-control">♪</div>

    <div class="envelope-container" id="mainEnvelope">
        <span id="env-label" style="color:#FFD700; z-index:5; font-size: 1.2rem; letter-spacing: 2px;">开启 2026 祝福</span>
        <button id="close-btn">✕</button>
        <div id="letter-content" style="display:none; width:100%;">
            <h2 style="color:var(--env-color); text-align:center; margin-top:0;">致：东、欣</h2>
            <div id="typewriter"></div>
        </div>
    </div>

    <script>
        const config = {
            text: "亲爱的朋友：\n\n新年的钟声即将敲响，所有的过往皆为序章。\n愿这封信随着温柔的波浪，带去我最真挚的祝福。\n生活如诗，岁月如画。\n愿 2026 年的你，万事胜意，不负韶华。"
        };

        // 1. 生成星空文字
        const starContainer = document.getElementById('star-container');
        const words = ["东", "欣", "2026", "✨", "❤️"];
        for (let i = 0; i < 50; i++) {
            const s = document.createElement('div');
            s.className = 'star-text';
            s.innerText = words[Math.floor(Math.random() * words.length)];
            s.style.left = Math.random() * 100 + "%";
            s.style.top = Math.random() * 100 + "%";
            s.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
            s.style.setProperty('--delay', (Math.random() * 5) + 's');
            starContainer.appendChild(s);
        }

        // 2. 打字机函数
        function typeWriter(text, i, fnCallback) {
            if (i < text.length) {
                document.getElementById("typewriter").innerHTML = text.substring(0, i+1) + '<span style="color:var(--env-color)">|</span>';
                setTimeout(() => typeWriter(text, i + 1, fnCallback), 100);
            } else {
                document.getElementById("typewriter").innerHTML = text;
                if (typeof fnCallback == 'function') fnCallback();
            }
        }

        // 3. 交互逻辑
        const env = document.getElementById('mainEnvelope');
        const audio = document.getElementById('bgAudio');
        const musicCtrl = document.getElementById('music-control');

        env.onclick = function(e) {
            // 排除关闭按钮点击
            if (this.classList.contains('is-open') || e.target.id === 'close-btn') return;
            
            this.classList.add('is-open');
            document.getElementById('env-label').style.display = 'none';
            document.getElementById('letter-content').style.display = 'block';
            audio.play().catch(() => {});
            musicCtrl.classList.add('playing');
            
            setTimeout(() => {
                typeWriter(config.text, 0);
            }, 800);
        };

        document.getElementById('close-btn').onclick = (e) => {
            e.stopPropagation(); // 阻止触发信封的 onclick 重新开启
            env.classList.remove('is-open');
            setTimeout(() => {
                document.getElementById('env-label').style.display = 'block';
                document.getElementById('letter-content').style.display = 'none';
                document.getElementById("typewriter").innerHTML = "";
            }, 800);
        };

        musicCtrl.onclick = function(e) {
            e.stopPropagation();
            if (audio.paused) { 
                audio.play(); 
                this.classList.add('playing'); 
            } else { 
                audio.pause(); 
                this.classList.remove('playing'); 
            }
        };
    </script>
</body>
</html>
</body>

</html>
